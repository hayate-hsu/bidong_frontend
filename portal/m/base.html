<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title><%block name="title">无线验证</%block></title>
    <link rel="stylesheet" type="text/css" href="/css/nsmbo.css">
    % if self.attr.autoAccount:
    <style>
        #autoAccount{
            background: url("/images/nsimgs/btn.png") no-repeat;
            background-size: 144px;
            width: 144px;
            height: 35px;
            position: absolute;
            bottom: 2px;
            left: 50%;
            margin-left: -72px;
            font-size: 1.4rem;
        }
    </style>
    % endif
    <%block name="jscode">
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/md5.js"></script>
    <script type="text/javascript" src="/js/ns.js?v=1.0.2"></script>
    </%block>
</head>

<body>
    <input type="hidden" id="user" value="${user}" />
    <input type="hidden" id="password" value="${password}" />
    <input type="hidden" id="openid" value="${openid}" />
    <input type="hidden" id="ac_ip" value="${ac_ip}" />
    <input type="hidden" id="vlanId" value="${vlan}" />
    <input type="hidden" id="ssid" value="${ssid}" />
    <input type="hidden" id="user_ip" value="${user_ip}" />
    <input type="hidden" id="user_mac" value="${user_mac}" />
    <input type="hidden" id="ap_mac" value="${ap_mac}" />
    <input type="hidden" id="firsturl" value="${firsturl}" />
    <input type="hidden" id="urlparam" value="${urlparam}" />
    <input type="hidden" id="appid" value="${appid}" />
    <input type="hidden" id="shopid" value="${shopid}" />
    <input type="hidden" id="pn" value="${pn}" />

    <div class="ns_header">
        <%block name="headerBg">
        <img src="/images/nsimgs/bg.jpg" class="ns_bg" />
        % if self.attr.autoAccount:
        <button type="button" id="autoAccount" onclick="autoAccount()">一键认证</button>
        % endif
        <!--<div>南横村</div>-->
        </%block>
    </div>

    % if self.attr.wxFlag:
    <div class="ns_box">
        <h3>第三方认证</h3>
        % if shopid:
        <button type="button" id="weixinAuthor"><i></i>微信上网</button>
        % else:
        <button type="button" id="weixinAuthor" disabled><i></i>微信上网</button>
        % endif
    </div>
    % endif

    <%block name="appDownload" />

    <div class="ns_box ${self.attr.color}" style="border: none;">
        <h3>${self.attr.accountTitle}</h3>
        <div class="ns_rz_wrapper FormAccount">
            % if self.attr.yzm:
            <div class="ns_rz_group"><input type="text" placeholder="账号/手机号：" name="user" id="userCtrl" /></div>
            <div class="ns_rz_group"><input type="password" placeholder="密码/验证码：" name="password" /><button type="button" id="yzm">获取验证码</button></div>
            % else:
            <div class="ns_rz_group"><input type="text" placeholder="账号：" name="user" /></div>
            <div class="ns_rz_group"><input type="password" placeholder="密码：" name="password" /></div>
            % endif
            % if self.attr.duty:
            <label id="autoLogin" data-name="nsName_${self.attr.nsName}"><input type="checkbox" />记住账号</label>
            % endif
            <button type="button" id="login">登录</button>
            <span class="ns_msg"></span>
            % if self.attr.duty:
            <label id="autoDuty"><input type="checkbox" checked />我已阅读并同意<a href="javascript:;">无线上网业务</a>免责声明</label>
            % endif
        </div>
    </div>

    % if self.attr.duty:
    <div class="ns_ctx">
        <h3>无线上网业务</h3>
        <p>1.请保护好您的个人信息与资料，请勿访问非法网站，勿发布违法信息,如有违反造成的损失和法律责任，由您自行承担。</p>
        <p>2.输入手机号，点击“获取密码”系统将下发密码短信至您的手机，输入密码后，点击“登录”即可上网。使用固定账号请咨询上网场所负责人获取账号密码。</p>
    </div>
    % endif

    % if self.attr.qrcode:
    <div class="ns_box" style="border-top:2px solid #f5f5f5;border-bottom:none">
        <h3>广东女院APP下载</h3>
        <a href="https://itunes.apple.com/us/app/id1127133673" class="ns_qrcode">
            <img src="/images/nsimgs/app_ios_school.png" />
        </a>
    </div>
    % endif

    <div class="ns_dmc">
        <div>
            <h3>选择下线设备</h3>
            <div class="dmlist"></div>
            <div class="btngroups">
                <button type="button" id="dmSub">确定</button><button type="button" id="dmQuit">取消</button>
            </div>
        </div>
    </div>

    <%block name="footer" />
</body>
<script type="text/javascript">
    $(function(){
        var u = navigator.userAgent;
        if(!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){
            $('.ns_qrcode').attr('href', 'https://itunes.apple.com/us/app/id1127133673');
            $('.ns_qrcode img').attr('src', '/images/nsimgs/app_ios_school.png');
        }else{
            $('.ns_qrcode').attr('href', 'http://58.248.228.170:9898/downloads/android/nzxy.apk');
            $('.ns_qrcode img').attr('src', '/images/nsimgs/app_andriod_school.png');
        }
        $('#weixinAuthor').click(function(){
            Wechat_GotoRedirect('${appid}', '${extend}', '${timestamp}', '${sign}', '${shopid}', '${authUrl}', '${user_mac}', '${ssid}', '${ap_mac}');
        });
    });
    document.addEventListener('visibilitychange', putNoResponse, false);
    document.body.addEventListener('touchstart', function(){});

    % if self.attr.autoAccount:
    function autoAccount(){
        var obj={
            user: '55532',
            password: '987012',
            openid: '${openid}',
            ac_ip: '${ac_ip}',
            vlanId: '${vlan}',
            ssid: '${ssid}',
            user_ip: '${user_ip}',
            user_mac: '${user_mac}',
            ap_mac: '${ap_mac}',
            firsturl: '${firsturl}',
            urlparam: '${urlparam}',
            appid: '${appid}',
            shopid: '${shopid}'
        };
        $.ajax({
            method: "POST",
            url: "/account",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(obj),
            dataType: "json",
            timeout: 30000,
            success: function (data) {
                window.location.href= urlChange('${firsturl}', '${urlparam}');
            },
            complete: function(xmlhttp, status){
                console.log(xmlhttp);
                if(status=='timeout'){
                    alert('认证超时，请重新认证！');
                }
            },
            error: function (error) {
                try{
                    alert('验证失败：'+error.responseJSON.Msg);
                }catch(e) {
                    alert('验证失败，请重新认证！');
                }
            }
        });
    }
    % endif
</script>
</html>
<%!
    color = 'G_orange';
    wxFlag = True;
    duty = False;
    nsName = 'auto';
    yzm = True;
    accountTitle = u'账户认证';
    qrcode = False;
    autoAccount = False;
%>